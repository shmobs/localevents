datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

// Define your own datamodels here and run `yarn redwood prisma migrate dev`
// to create migrations for them and apply to your dev DB.

model Business {
  id          String     @id @default(cuid())
  name        String
  description String
  website     String?
  locations   Location[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Location {
  id           String   @id @default(cuid())
  address      String
  gmapsPlaceId String   @unique
  businessId   String
  business     Business @relation(fields: [businessId], references: [id])
  events       Event[]

  latitude  Float
  longitude Float

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([businessId], name: "businessId")
  @@index([gmapsPlaceId])
}

enum EventStatus {
  REQUESTED
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Event {
  id          String      @id @default(cuid())
  name        String
  type        String
  description String
  status      EventStatus
  date        DateTime?
  locationId  String?
  location    Location?   @relation(fields: [locationId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([locationId], name: "locationId")
}
